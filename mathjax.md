# MathJax

Some details and links about MathJax and its configuration.  I have made the decision to target MathJax v3: this is an ongoing endeavour, and v3 is the future; in a few years, it will be the standard, and probably my workflow will not have changed much.

MathJax is by now mature technology, and for rendering mathematics on a website, it produces (in my opinion) beautiful results.  So here I want to concentrate on support for screen readers.  I have never before used a screen reader, so this is all rather making it up as I go along.

(Also, it must be said that I do not _currently_ teach any students who, to my knowledge, use a screen-reader.  Obviously we should prepare for this eventually, rather than be rushing around trying to make things work should a student one day turn up needing to use this technology.  But it can feel a little like shooting in the dark: what if I end up testing with a tool no-one actually really uses?)


### Performance

This is just my personal experience.  MathJax can be a bit slow, even on a modern desktop.  In MathML mode (that is, rendering MathML, not LaTeX commands) it seems to stall out more obviously, making the web-page non-response for a few seconds.  Turning on the accessibility tools makes this noticeably worse.

On my very old Surface Pro laptop, the performance is dismal, to the point of making a long document almost unusable.

**Moral:** Another reason to keep HTML documents short, and allow easy navigation between different documents to form a larger body of work.


## What we should actually expect

At this point, I spent some time researching what exactly a screen reader is _meant_ to do.  The results are... disappointing.

- [NVDA with MathJax demo](https://www.youtube.com/watch?v=mTFWb18fpaM) : youtube video
- [MathJax demo](https://www.youtube.com/watch?v=6GSgTjorewQ&feature=youtu.be) : youtube video of different systems
- [MathJax v3 overview](https://progressiveaccess.com/ahg19/ahg19.html) : Conference talk text

A more natural demonstration can be seen here:

- [Reading MathJax with NVDA](http://stemenable.s805.sureserver.com/Reading_MathJax_with_NVDA)


## Testing with ChromeVox

This is a screen reader which appears in the MathJax docs, and context menus.  You can install it for Chrome from the webstore: [ChromeVox](https://chrome.google.com/webstore/detail/chromevox-classic-extensi/kgejglhpjiefppelpmljglcjbhoiplfn).  Weirdly, if you visit the very similar ULR [ChromeVox with en modifier](https://chrome.google.com/webstore/detail/chromevox-classic-extensi/kgejglhpjiefppelpmljglcjbhoiplfn?hl=en) then you a different description, including:

> Please note that this extension is now in maintenance mode; no new additions will be made moving forward.

It seems that the tool is being transitioned to an OS level tool inside ChromeOS.  Maybe I need to test on my chromebook.

I had a fight getting ChromeVox to work, and initially decided it just didn't work.  A few days later, my experience is that my Surface Pro is completely unusable.  Removing and reinstalling the extension improved that to "very slow".  On a desktop PC, I can get it to, approximately, work.  Tests performed using the documents produced from [make4ht examples](make4ht.md).

- The key seems to be to "navigate" around the document.
- Open the "ChromeVox Options" and check the current KeyMap.  Make sure that the "ChromeVox modifier key" is set.  I found "Ctrl+Shift" to be best ("Ctrl+Alt" is a reserved Windows combination, and expect bad things to if you press "Ctrl-Alt-DownArrow" for example ("+UpArrow" fixes this)).
- The default "Classic Keymap" allows you to use Ctrl+Shift+Up/DownArrow to navigate around the (logical, HTML) structure of the document.
- By repeatedly pressing DownArrow, I was able to get it to read a document, with the inline or displayed Mathematics, in a reasonably good way.
- On Windows, the voice driver seems to swallow the letter "A", which makes reading variable names difficult (see notes below on NVDA)

Testing with MathJax v2:
- Seems to work fine.  For consistent results (e.g. with MathML input) make sure the Accessibility -> Assistive MathML is selected in the MathJax context menu.

Testing with MathJax v3:
- You must use context menu -> Accessibility -> Active
- This [StackOverflow question](https://stackoverflow.com/questions/60688026/how-to-activate-mathjax-accessibility-by-default) suggests that it's not possible to active the accessibility tools by default!  However, the setting does seem to persist, I think at the "web page" level.
- I cannot get ChromeVox to read the formulae as part of the "flow" of the document; but selecting the formulae elements does work.

The accessibility tools in version 3 seem to be slightly buggy still.  I managed to find a breaking case, and filled a bug report on GitHub.  The [MathML example](https://matthewdaws.github.io/AccessibleLaTeX/make4ht%20project%203/main.html) generated by `make4ht` renders fine normally, but if you turn on the accessibility tools and scroll to the end of the screen, is displays a large number of errors (latest versions of Firefox or Chrome).  (It is possible this is related to the build problems I saw from `make4ht`).


## NVDA

This is a free screen reader, which seems to work well on Windows, and in particular for FireFox.  Having installed [NVDA](https://www.nvaccess.org/), I could interact with math elements, but not get them to read as part of the main text.  However, upon installing a further piece of (free, not open-source) software: [MathPlayer](https://www.dessci.com/en/products/mathplayer/download.htm) it does work.

- I find the reliance on a piece of 4.5 year old software a little disturbing.
- MathPlayer is not something that has a _configuration_, so it is hard to perform tests.

Some notes about NVDA:

- On windows, the default speech "synthesizer" seems to swallow certain letters (most notably "a").  I found changing it to "eSpeak NG" gave a far more artificial voice, but one which does correctly pronounce every letter / word.
- I found the guidance [available here](https://www.marcozehe.de/how-to-use-nvda-and-firefox-to-test-your-web-pages-for-accessibility/) to be really useful.  The stuff about settings seems incompatible with my copy of NVDA, but the keyboard guide is perfect.
- In particular:
  - Pressing up/down will navigate through (logical, HTML) sections of the document, reading them out.  I had success in reading text and maths by repeatedly pressing "down" to hear the next section
  - The "nvda-key" is "insert", and pressing this together with F7 displays a dialogue showing the structure of the HTML document, as NVDA seems it.  I imagine this could be useful when thinking about how to structure a document.
  
Once configured correctly, NVDA works pretty well with MathJax v2 and v3, in either TeX or MathML input modes.


## Documentation

- [Configuration](http://docs.mathjax.org/en/latest/web/configuration.html#web-configuration) of MathJax v3.
